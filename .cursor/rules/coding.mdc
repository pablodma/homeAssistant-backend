---
description: Estándares de código Python/FastAPI
globs:
  - "**/*.py"
---

# Estándares de Código - Python

## General
- Python 3.11+
- Type hints obligatorios
- Docstrings para funciones públicas
- PEP 8 + Black formatter

## Naming
- snake_case para variables y funciones
- PascalCase para clases
- UPPER_CASE para constantes

## FastAPI
- Async/await para operaciones I/O
- Dependency injection via `Depends()`
- Pydantic v2 para validación
- Repositorios para acceso a DB (no queries directas en routers)

## Endpoints
- Siempre validar tenant_id en path o del token
- Retornar errores HTTP estándar (400, 401, 403, 404, 500)
- Responses tipados con Pydantic models

## Base de Datos
- Usar asyncpg para conexiones async
- Connection pooling obligatorio
- Queries parametrizadas siempre
- Idempotency keys para operaciones de escritura

## Testing
- pytest + pytest-asyncio
- Fixtures para test database
- Tests de aislamiento multi-tenant
